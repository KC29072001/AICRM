<!-- 

# AI CRM
### Features


#### Authenticate with Gmail using OAuth 2.0 to access emails securely.

#### Search Emails by providing a query string and retrieve relevant emails.

#### Summarize Results with a concise summary generated by the Gemini API.

#### Configurable maximum number of results (default: 10).


## Run Locally

Clone the project

```bash
  git clone <repository-url>
```

Go to the project directory

```bash
  cd my-project
```

Install python version 3.11.0 or 3.11.0+ from https://www.python.org/downloads/release/python-3110/


Create a new virtual environment

```bash
  python -m venv crmenv
```

Activate it

```bash
  crmenv\Scripts\activate
```

Install dependencies

```bash
  pip install -r requirements.txt
```

Start the server

```bash
  python main.py
```

## API Reference

### Authenticate email  

```http
  GET /auth/start?gmail_address=<your_gmail_address>
```

| Parameter | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `gmail_address` | `string` | **Required**. The Gmail address to authenticate.|

Response - 
```bash
{
  "auth_url": "generated_auth_url"
}

```
### Retrieve list of relevant message objects

```http
   POST /api/v1/retrieve
```

| Parameter | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `query` | `string` | **Required**. Search query for emails.|
| `max_results` | `integer` | **Optional**. Maximum number of results (default: 10).|
| `gmail_address` | `string` | **Required**. Gmail address to search.|

Response -
```bash
{
  "status": "success",
  "results": [
    {
      "id": "196da47dccc2cb0f",
      "snippet": "Hello, Blueskythinker. Welcome to the regular Codeforces round. I&#39;m glad to invite you to take part in Codeforces Round 1025 (Div. 2). It starts on Saturday, May, 17, 2025 14:35 (UTC). The contest",
      "from": "Codeforces@codeforces.com",
      "subject": "Codeforces Round 1025 (Div. 2)",
      "date": "1747416346000",
      "link": "https://mail.google.com/mail/u/0/#inbox/196da47dccc2cb0f"
    },
    {
      "id": "196bb9de22a38579",
      "snippet": "Hello, Blueskythinker. I&#39;m glad to invite you to take part in Codeforces Round 1024. Actually it will be two separate rounds &quot;Codeforces Round #1024 (Div. 1)&quot; and &quot;Codeforces Round #",
      "from": "noreply@codeforces.com",
      "subject": "Codeforces Round 1024",
      "date": "1746901846000",
      "link": "https://mail.google.com/mail/u/0/#inbox/196bb9de22a38579"
    }
  ],
  "summary": "The search query \"from:Codeforces\" returned two emails concerning upcoming Codeforces rounds.  One email announces Codeforces Round 1025 (Div. 2) scheduled for Saturday, May 17, 2025, at 14:35 UTC.  Another email details Codeforces Round 1024, noting it will be split into two separate divisions (Div. 1 and Div. 2).  Both emails are invitations to participate."
}
``` -->




# AI CRM
### Features


#### Authenticate with Gmail using OAuth 2.0 to access emails securely.

#### Search Emails by providing a query string and retrieve relevant emails.

#### Summarize Results with a concise summary generated by the Gemini API.

#### Configurable maximum number of results (default: 10).


## Run Locally

Clone the project

```bash
  git clone <repository-url>
```

Go to the project directory

```bash
  cd my-project
```

Install python version 3.11.0 or 3.11.0+ from https://www.python.org/downloads/release/python-3110/


Create a new virtual environment

```bash
  python -m venv crmenv
```

Activate it

```bash
  crmenv\Scripts\activate
```

Install dependencies

```bash
  pip install -r requirements.txt
```

Start the server

```bash
  python main.py
```

## API Reference

### Authenticate email  

```http
  GET /auth/start?gmail_address=<your_gmail_address>
```

| Parameter | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `gmail_address` | `string` | **Required**. The Gmail address to authenticate.|

Response - 
```bash
{
  "auth_url": "generated_auth_url"
}
```

### Authenticate Odoo  


```http
   POST /auth/odoo

```

| Parameter | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `odoo_url` | `string` | **Required**. URL of the Odoo instance (e.g., https://your-odoo-instance.com).|
| `odoo_db` | `integer` | **Required**. Name of the Odoo database.|
| `odoo_username` | `string` | **Required**. Odoo username for authentication.|
| `odoo_password` | `string` | **Required**. Odoo password for authentication.|

Response -
```bash
{
  "message": "Odoo authentication successful. You can now use the /info/api/v1/retrieve endpoint with source='odoo' and gmail_address='odoo_username' and can also use /odoo/api/v1/chat endpoint with username='odoo_username'."
}
```


### Retrieve list of relevant message objects

```http
   POST info/api/v1/retrieve
```

| Parameter | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `query` | `string` | **Required**. Search query for emails.|
| `max_results` | `integer` | **Optional**. Maximum number of results (default: 10).|
| `gmail_address` | `string` | **Required**. Gmail address to search.|
| `source` | `string` | **Required**. Required. Must be set to "odoo" for Odoo or to "gmail" for Gmail.|

Response - For Gmail -
```bash
{
  "status": "success",
  "results": [
    {
      "id": "196da47dccc2cb0f",
      "snippet": "Hello, Blueskythinker. Welcome to the regular Codeforces round. I&#39;m glad to invite you to take part in Codeforces Round 1025 (Div. 2). It starts on Saturday, May, 17, 2025 14:35 (UTC). The contest",
      "from": "Codeforces@codeforces.com",
      "subject": "Codeforces Round 1025 (Div. 2)",
      "date": "1747416346000",
      "link": "https://mail.google.com/mail/u/0/#inbox/196da47dccc2cb0f"
    },
    {
      "id": "196bb9de22a38579",
      "snippet": "Hello, Blueskythinker. I&#39;m glad to invite you to take part in Codeforces Round 1024. Actually it will be two separate rounds &quot;Codeforces Round #1024 (Div. 1)&quot; and &quot;Codeforces Round #",
      "from": "noreply@codeforces.com",
      "subject": "Codeforces Round 1024",
      "date": "1746901846000",
      "link": "https://mail.google.com/mail/u/0/#inbox/196bb9de22a38579"
    }
  ],
  "summary": "The search query \"from:Codeforces\" returned two emails concerning upcoming Codeforces rounds.  One email announces Codeforces Round 1025 (Div. 2) scheduled for Saturday, May 17, 2025, at 14:35 UTC.  Another email details Codeforces Round 1024, noting it will be split into two separate divisions (Div. 1 and Div. 2).  Both emails are invitations to participate."
}
```

Response - For Odoo -
```bash
{
  "status": "success",
  "results": [
    {
      "id": 3,
      "display_name": "Jagan Hardware Updated",
      "duration_tracking": {
        "1": 405294,
        "2": 546387,
        "3": 0
      },
      "campaign_id": false,
      "source_id": false,
      "medium_id": false,
      "activity_ids": [],
      "activity_state": false,
      "activity_user_id": false,
      "activity_type_id": false,
      "activity_type_icon": false,
      "activity_date_deadline": false,
      "my_activity_date_deadline": false,
      "activity_summary": false,
      "activity_exception_decoration": false,
      "activity_exception_icon": false,
      "activity_calendar_event_id": false,
      "message_is_follower": true,
      "message_follower_ids": [
        5
      ],
      "message_partner_ids": [
        3
      ],
      "message_ids": [
        104,
        100,
        99,
        98,
        97,
        67,
        64
      ],
      "has_message": true,
      "message_needaction": false,
      "message_needaction_counter": 0,
      "message_has_error": false,
      "message_has_error_counter": 0,
      "message_attachment_count": 0,
      "website_message_ids": [],
      "message_has_sms_error": false,
      "phone_sanitized": false,
      "phone_sanitized_blacklisted": false,
      "phone_blacklisted": false,
      "phone_mobile_search": false,
      "email_normalized": "info@jaganhardware.com",
      "is_blacklisted": false,
      "message_bounce": 0,
      "email_cc": false,
      "name": "Jagan Hardware Updated",
      "user_id": [
        2,
        "Kartikey"
      ],
      "user_company_ids": [
        1
      ],
      "team_id": [
        1,
        "Sales"
      ],
      "lead_properties": [],
      "company_id": [
        1,
        "Infrahive"
      ],
      "referred": false,
      "description": false,
      "active": true,
      "type": "opportunity",
      "priority": "0",
      "stage_id": [
        2,
        "Qualified"
      ],
      "tag_ids": [],
      "color": 0,
      "expected_revenue": 15000.0,
      "prorated_revenue": 11250.0,
      "recurring_revenue": 0.0,
      "recurring_plan": false,
      "recurring_revenue_monthly": 0.0,
      "recurring_revenue_monthly_prorated": 0.0,
      "recurring_revenue_prorated": 0.0,
      "company_currency": [
        20,
        "INR"
      ],
      "date_closed": false,
      "date_automation_last": false,
      "date_open": "2025-05-22 13:55:45",
      "day_open": 0.0,
      "day_close": 0.0,
      "date_last_stage_update": "2025-05-27 06:30:43",
      "date_conversion": false,
      "date_deadline": false,
      "commercial_partner_id": false,
      "partner_id": false,
      "partner_is_blacklisted": false,
      "contact_name": false,
      "partner_name": "JAGAN Hardware",
      "function": false,
      "email_from": "info@jaganhardware.com",
      "email_domain_criterion": "@jaganhardware.com",
      "phone": "+1987654321",
      "phone_state": "incorrect",
      "email_state": "correct",
      "website": "https://www.jaganhardware.com",
      "lang_id": false,
      "lang_code": false,
      "lang_active_count": 1,
      "street": "Jagan Hardware, Raman Square, Industrial Area Phase I, Chandigarh, 160102, India",
      "street2": false,
      "zip": "160102",
      "city": "Chandigarh",
      "state_id": [
        582,
        "Chandigarh (IN)"
      ],
      "country_id": [
        104,
        "India"
      ],
      "probability": 75.0,
      "automated_probability": 50.0,
      "is_automated_probability": false,
      "won_status": "pending",
      "lost_reason_id": false,
      "calendar_event_ids": [],
      "duplicate_lead_ids": [
        3
      ],
      "duplicate_lead_count": 0,
      "meeting_display_date": false,
      "meeting_display_label": "No Meeting",
      "partner_email_update": false,
      "partner_phone_update": false,
      "is_partner_visible": true,
      "create_uid": [
        2,
        "Kartikey"
      ],
      "create_date": "2025-05-22 13:55:45",
      "write_uid": [
        2,
        "Kartikey"
      ],
      "write_date": "2025-05-27 16:52:58",
      "days_to_convert": 0.0,
      "days_exceeding_closing": 0.0,
      "reveal_id": "a2894e00-9eb8-4f0e-8928-99076478022a",
      "iap_enrich_done": false,
      "show_enrich_button": false,
      "lead_mining_request_id": [
        1,
        "LMR001"
      ],
      "activity_logs": [
        {
          "type": "message",
          "date": "2025-05-27 16:52:30",
          "ist-time": "2025-05-27 22:22:30",
          "author": "Kartikey",
          "message": ""
        },
        {
          "type": "message",
          "date": "2025-05-27 06:30:43",
          "ist-time": "2025-05-27 12:00:43",
          "author": "Kartikey",
          "message": ""
        },
        {
          "type": "stage_change",
          "date": "2025-05-27 06:30:43",
          "ist-time": "2025-05-27 12:00:43",
          "previous_stage": "New",
          "new_stage": "Qualified",
          "author": "System",
          "message": ""
        },
        {
          "type": "message",
          "date": "2025-05-27 06:29:33",
          "ist-time": "2025-05-27 11:59:33",
          "author": "Kartikey",
          "message": ""
        },
        {
          "type": "message",
          "date": "2025-05-27 06:29:32",
          "ist-time": "2025-05-27 11:59:32",
          "author": "Kartikey",
          "message": ""
        },
        {
          "type": "message",
          "date": "2025-05-27 06:29:31",
          "ist-time": "2025-05-27 11:59:31",
          "author": "Kartikey",
          "message": ""
        },
        {
          "type": "message",
          "date": "2025-05-22 13:55:46",
          "ist-time": "2025-05-22 19:25:46",
          "author": "Kartikey",
          "message": "<div summary=\"o_mail_notification\"><p>A new lead has been created for the team \"Sales\".</p></div>"
        },
        {
          "type": "creation",
          "date": "2025-05-22 13:55:45",
          "ist-time": "2025-05-22 19:25:45",
          "author": "System",
          "message": ""
        },
        {
          "type": "stage_change",
          "date": "2025-05-22 13:55:45",
          "ist-time": "2025-05-22 19:25:45",
          "previous_stage": "None",
          "new_stage": "New",
          "author": "System",
          "message": ""
        }
      ]
    }
  ],
  "source": "odoo",
  "summary": "The Odoo search found one lead: \"Jagan Hardware Updated,\" an opportunity managed by Kartikey from the Sales team within Infrahive. The lead is currently in the \"Qualified\" stage, with a 75% probability and an expected revenue of INR 15,000.00. Key contact information includes email address info@jaganhardware.com and phone number +1987654321. The company website is https://www.jaganhardware.com, located in Chandigarh, India. Recent activity logs indicate the opportunity was created on May 22, 2025, and moved to the \"Qualified\" stage on May 27, 2025. The creation message details additional company information pulled in by Lead Generation."
}
```

```http
POST /odoo/api/v1/chat
```
| Parameter | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `query` | `string` | **Required**. Natural language query describing the desired CRM operation (e.g., "query": "Modify the lead KC Electronics with phone +1234567890, revenue 111, and priority high").|
| `username` | `string` | **Required**. Odoo username (email) used for authentication, as provided in /auth/odoo.|


Response -

```bash 
{
  "status": "success",
  "operation": "update",
  "result": {
    "id": 23,
    "display_name": "KC Electronics",
    "duration_tracking": {
      "1": 13841
    },
    "campaign_id": false,
    "source_id": false,
    "medium_id": false,
    "activity_ids": [],
    "activity_state": false,
    "activity_user_id": false,
    "activity_type_id": false,
    "activity_type_icon": false,
    "activity_date_deadline": false,
    "my_activity_date_deadline": false,
    "activity_summary": false,
    "activity_exception_decoration": false,
    "activity_exception_icon": false,
    "activity_calendar_event_id": false,
    "message_is_follower": true,
    "message_follower_ids": [
      27
    ],
    "message_partner_ids": [
      3
    ],
    "message_ids": [
      131,
      130
    ],
    "has_message": true,
    "message_needaction": false,
    "message_needaction_counter": 0,
    "message_has_error": false,
    "message_has_error_counter": 0,
    "message_attachment_count": 0,
    "website_message_ids": [],
    "message_has_sms_error": false,
    "phone_sanitized": false,
    "phone_sanitized_blacklisted": false,
    "phone_blacklisted": false,
    "phone_mobile_search": false,
    "email_normalized": false,
    "is_blacklisted": false,
    "message_bounce": 0,
    "email_cc": false,
    "name": "KC Electronics",
    "user_id": [
      2,
      "Kartikey"
    ],
    "user_company_ids": [
      1
    ],
    "team_id": [
      1,
      "Sales"
    ],
    "lead_properties": [],
    "company_id": [
      1,
      "Infrahive"
    ],
    "referred": false,
    "description": "<p>Electronics Supplier</p>",
    "active": true,
    "type": "opportunity",
    "priority": "2",
    "stage_id": [
      1,
      "New"
    ],
    "tag_ids": [],
    "color": 0,
    "expected_revenue": 111,
    "prorated_revenue": 55.5,
    "recurring_revenue": 0,
    "recurring_plan": false,
    "recurring_revenue_monthly": 0,
    "recurring_revenue_monthly_prorated": 0,
    "recurring_revenue_prorated": 0,
    "company_currency": [
      20,
      "INR"
    ],
    "date_closed": false,
    "date_automation_last": false,
    "date_open": "2025-06-03 09:59:41",
    "day_open": 0,
    "day_close": 0,
    "date_last_stage_update": "2025-06-03 09:59:41",
    "date_conversion": false,
    "date_deadline": false,
    "commercial_partner_id": false,
    "partner_id": false,
    "partner_is_blacklisted": false,
    "contact_name": false,
    "partner_name": false,
    "function": false,
    "email_from": false,
    "email_domain_criterion": false,
    "phone": "+1234567890",
    "phone_state": "incorrect",
    "email_state": false,
    "website": false,
    "lang_id": false,
    "lang_code": false,
    "lang_active_count": 1,
    "street": false,
    "street2": false,
    "zip": false,
    "city": false,
    "state_id": false,
    "country_id": false,
    "probability": 50,
    "automated_probability": 0,
    "is_automated_probability": false,
    "won_status": "pending",
    "lost_reason_id": false,
    "calendar_event_ids": [],
    "duplicate_lead_ids": [
      23
    ],
    "duplicate_lead_count": 0,
    "meeting_display_date": false,
    "meeting_display_label": "No Meeting",
    "partner_email_update": false,
    "partner_phone_update": false,
    "is_partner_visible": true,
    "create_uid": [
      2,
      "Kartikey"
    ],
    "create_date": "2025-06-03 09:59:41",
    "write_uid": [
      2,
      "Kartikey"
    ],
    "write_date": "2025-06-03 13:50:21",
    "days_to_convert": 0,
    "days_exceeding_closing": 0,
    "reveal_id": false,
    "iap_enrich_done": false,
    "show_enrich_button": false,
    "lead_mining_request_id": false
  },
  "message": "Lead with ID 23 updated"
}

```
